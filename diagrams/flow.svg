<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1343px" preserveAspectRatio="none" style="width:1087px;height:1343px;" version="1.1" viewBox="0 0 1087 1343" width="1087px" zoomAndPan="magnify"><defs><filter height="300%" id="f14khs3ubau4za" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="560" cy="20" fill="#000000" filter="url(#f14khs3ubau4za)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="499.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="101" x="509.5" y="71.1387">start thread pool</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="482" y="147.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="136" x="492" y="169.1074">server listen on port X</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="471" y="201.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="158" x="481" y="223.0762">incomming tcp connection</text><path d="M112,245.9063 L112,316.4375 A0,0 0 0 0 112,316.4375 L415,316.4375 A0,0 0 0 0 415,316.4375 L415,285.1719 L435,281.1719 L415,277.1719 L415,255.9063 L405,245.9063 L112,245.9063 A0,0 0 0 0 112,245.9063 " fill="#FBFB77" filter="url(#f14khs3ubau4za)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M405,245.9063 L405,255.9063 L415,255.9063 L405,245.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="118" y="262.9731">a worker thread handles the connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="118" y="278.106">from start to end - this can be optimized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="118" y="293.2388">using event-driven approach but we choose</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="118" y="308.3716">not to as it's an overkill for this assignment</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="250" x="435" y="264.1875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="445" y="285.3262">add new job to the thread pool queue</text><polygon fill="#FEFECE" filter="url(#f14khs3ubau4za)" points="512,103.9688,608,103.9688,620,115.9688,608,127.9688,512,127.9688,500,115.9688,512,103.9688" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="96" x="512" y="119.7769">server is running</text><ellipse cx="90" cy="157.9688" fill="#FFFFFF" filter="url(#f14khs3ubau4za)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 2.5;" x1="83.8128" x2="96.1872" y1="151.7816" y2="164.1559"/><line style="stroke: #000000; stroke-width: 2.5;" x1="96.1872" x2="83.8128" y1="151.7816" y2="164.1559"/><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="190" x="465" y="392.4375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="170" x="475" y="413.5762">send job to a worker thread</text><rect fill="#000000" filter="url(#f14khs3ubau4za)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1004" x="45" y="446.4063"/><polygon fill="#FEFECE" filter="url(#f14khs3ubau4za)" points="223.25,472.4063,310.25,472.4063,322.25,484.4063,310.25,496.4063,223.25,496.4063,211.25,484.4063,223.25,472.4063" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="87" x="223.25" y="488.2144">HTTP CONNECT</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="190.25" y="481.812">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="322.25" y="481.812">no</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="57" y="506.4063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="67" y="527.5449">parse HTTP message and</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="140" x="67" y="541.5137">extract server address</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="210" x="284.5" y="506.4063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="190" x="294.5" y="527.5449">create ssl frontend handler and</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="121" x="294.5" y="541.5137">bind tcp socket to it</text><polygon fill="#FEFECE" filter="url(#f14khs3ubau4za)" points="325.5,574.3438,453.5,574.3438,465.5,586.3438,453.5,598.3438,325.5,598.3438,313.5,586.3438,325.5,574.3438" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="128" x="325.5" y="590.1519">SNI extension present</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="292.5" y="583.7495">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="465.5" y="583.7495">no</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="261" y="608.3438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="65" x="271" y="629.4824">extract SNI</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="414" y="608.3438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="103" x="424" y="629.4824">close connection</text><ellipse cx="475.5" cy="672.3125" fill="#FFFFFF" filter="url(#f14khs3ubau4za)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 2.5;" x1="469.3128" x2="481.6872" y1="666.1253" y2="678.4997"/><line style="stroke: #000000; stroke-width: 2.5;" x1="481.6872" x2="469.3128" y1="666.1253" y2="678.4997"/><polygon fill="#FEFECE" filter="url(#f14khs3ubau4za)" points="266.75,692.3125,278.75,704.3125,266.75,716.3125,254.75,704.3125,266.75,692.3125" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="208.75" y="736.3125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="218.75" y="757.4512">create ssl client</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="191.25" y="838.6836"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="131" x="201.25" y="859.8223">connect to the server</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="61.9063" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="247" x="143.25" y="907.6523"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="209" x="153.25" y="928.791">generate dynamic certificate using</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="153.25" y="942.7598">the real server certificate</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="227" x="153.25" y="956.7285">and configured key and CA certificate</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="167.25" y="989.5586"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="179" x="177.25" y="1010.6973">save certificate in local cache</text><polygon fill="#FEFECE" filter="url(#f14khs3ubau4za)" points="162.75,790.2813,370.75,790.2813,382.75,802.2813,370.75,814.2813,162.75,814.2813,150.75,802.2813,162.75,790.2813" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="270.75" y="824.4917">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="162.75" y="806.0894">server certificate</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="264.75" y="806.0894">not</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="78" x="292.75" y="806.0894">in local cache</text><polygon fill="#FEFECE" filter="url(#f14khs3ubau4za)" points="266.75,1043.5273,278.75,1055.5273,266.75,1067.5273,254.75,1055.5273,266.75,1043.5273" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="252" x="140.75" y="1087.5273"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="232" x="150.75" y="1108.666">use certificate for frontend connection</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="163" x="185.25" y="1141.4961"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="143" x="195.25" y="1162.6348">read user HTTP request</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="330" x="101.75" y="1195.4648"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="310" x="111.75" y="1216.6035">forward the message through all processing layers</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="293" x="120.25" y="1249.4336"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="273" x="130.25" y="1270.5723">propegate server response back to the user</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="144" x="585" y="869.6211"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="124" x="595" y="890.7598">same handeling flow</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="144" x="739" y="869.6211"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="124" x="749" y="890.7598">same handeling flow</text><rect fill="#FEFECE" filter="url(#f14khs3ubau4za)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="144" x="893" y="869.6211"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="124" x="903" y="890.7598">same handeling flow</text><rect fill="#000000" filter="url(#f14khs3ubau4za)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1004" x="45" y="1303.4023"/><polygon fill="#FEFECE" filter="url(#f14khs3ubau4za)" points="502,348.4375,618,348.4375,630,360.4375,618,372.4375,502,372.4375,490,360.4375,502,348.4375" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="116" x="502" y="364.2456">thread pool has jobs</text><ellipse cx="24" cy="403.4375" fill="#FFFFFF" filter="url(#f14khs3ubau4za)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="24" cy="403.4375" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="30" y2="50"/><polygon fill="#A80036" points="556,40,560,50,564,40,560,44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="181.9375" y2="201.9375"/><polygon fill="#A80036" points="556,191.9375,560,201.9375,564,191.9375,560,195.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="235.9063" y2="264.1875"/><polygon fill="#A80036" points="556,254.1875,560,264.1875,564,254.1875,560,258.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="127.9688" y2="147.9688"/><polygon fill="#A80036" points="556,137.9688,560,147.9688,564,137.9688,560,141.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="298.1563" y2="326.4375"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="697" y1="326.4375" y2="326.4375"/><polygon fill="#A80036" points="693,235.2031,697,225.2031,701,235.2031,697,231.2031" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="697" x2="697" y1="115.9688" y2="326.4375"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="697" x2="620" y1="115.9688" y2="115.9688"/><polygon fill="#A80036" points="630,111.9688,620,115.9688,630,119.9688,626,115.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="500" x2="90" y1="115.9688" y2="115.9688"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="90" x2="90" y1="115.9688" y2="147.9688"/><polygon fill="#A80036" points="86,137.9688,90,147.9688,94,137.9688,90,141.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="83.9688" y2="103.9688"/><polygon fill="#A80036" points="556,93.9688,560,103.9688,564,93.9688,560,97.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="475.5" x2="475.5" y1="642.3125" y2="662.3125"/><polygon fill="#A80036" points="471.5,652.3125,475.5,662.3125,479.5,652.3125,475.5,656.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="313.5" x2="303.5" y1="586.3438" y2="586.3438"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="303.5" x2="303.5" y1="586.3438" y2="608.3438"/><polygon fill="#A80036" points="299.5,598.3438,303.5,608.3438,307.5,598.3438,303.5,602.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="465.5" x2="475.5" y1="586.3438" y2="586.3438"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="475.5" x2="475.5" y1="586.3438" y2="608.3438"/><polygon fill="#A80036" points="471.5,598.3438,475.5,608.3438,479.5,598.3438,475.5,602.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="303.5" x2="303.5" y1="642.3125" y2="704.3125"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="303.5" x2="278.75" y1="704.3125" y2="704.3125"/><polygon fill="#A80036" points="288.75,700.3125,278.75,704.3125,288.75,708.3125,284.75,704.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="389.5" x2="389.5" y1="554.3438" y2="574.3438"/><polygon fill="#A80036" points="385.5,564.3438,389.5,574.3438,393.5,564.3438,389.5,568.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="211.25" x2="144" y1="484.4063" y2="484.4063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="144" x2="144" y1="484.4063" y2="506.4063"/><polygon fill="#A80036" points="140,496.4063,144,506.4063,148,496.4063,144,500.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="322.25" x2="389.5" y1="484.4063" y2="484.4063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="389.5" x2="389.5" y1="484.4063" y2="506.4063"/><polygon fill="#A80036" points="385.5,496.4063,389.5,506.4063,393.5,496.4063,389.5,500.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="144" x2="144" y1="554.3438" y2="704.3125"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="144" x2="254.75" y1="704.3125" y2="704.3125"/><polygon fill="#A80036" points="244.75,700.3125,254.75,704.3125,244.75,708.3125,248.75,704.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="716.3125" y2="736.3125"/><polygon fill="#A80036" points="262.75,726.3125,266.75,736.3125,270.75,726.3125,266.75,730.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="872.6523" y2="907.6523"/><polygon fill="#A80036" points="262.75,897.6523,266.75,907.6523,270.75,897.6523,266.75,901.6523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="969.5586" y2="989.5586"/><polygon fill="#A80036" points="262.75,979.5586,266.75,989.5586,270.75,979.5586,266.75,983.5586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="814.2813" y2="838.6836"/><polygon fill="#A80036" points="262.75,828.6836,266.75,838.6836,270.75,828.6836,266.75,832.6836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="382.75" x2="400.25" y1="802.2813" y2="802.2813"/><polygon fill="#A80036" points="396.25,928.6055,400.25,938.6055,404.25,928.6055,400.25,932.6055" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="400.25" x2="400.25" y1="802.2813" y2="1055.5273"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="400.25" x2="278.75" y1="1055.5273" y2="1055.5273"/><polygon fill="#A80036" points="288.75,1051.5273,278.75,1055.5273,288.75,1059.5273,284.75,1055.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="1023.5273" y2="1043.5273"/><polygon fill="#A80036" points="262.75,1033.5273,266.75,1043.5273,270.75,1033.5273,266.75,1037.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="770.2813" y2="790.2813"/><polygon fill="#A80036" points="262.75,780.2813,266.75,790.2813,270.75,780.2813,266.75,784.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="1067.5273" y2="1087.5273"/><polygon fill="#A80036" points="262.75,1077.5273,266.75,1087.5273,270.75,1077.5273,266.75,1081.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="1121.4961" y2="1141.4961"/><polygon fill="#A80036" points="262.75,1131.4961,266.75,1141.4961,270.75,1131.4961,266.75,1135.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="1175.4648" y2="1195.4648"/><polygon fill="#A80036" points="262.75,1185.4648,266.75,1195.4648,270.75,1185.4648,266.75,1189.4648" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="1229.4336" y2="1249.4336"/><polygon fill="#A80036" points="262.75,1239.4336,266.75,1249.4336,270.75,1239.4336,266.75,1243.4336" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="452.4063" y2="472.4063"/><polygon fill="#A80036" points="262.75,462.4063,266.75,472.4063,270.75,462.4063,266.75,466.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="657" x2="657" y1="452.4063" y2="869.6211"/><polygon fill="#A80036" points="653,859.6211,657,869.6211,661,859.6211,657,863.6211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="811" x2="811" y1="452.4063" y2="869.6211"/><polygon fill="#A80036" points="807,859.6211,811,869.6211,815,859.6211,811,863.6211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="965" x2="965" y1="452.4063" y2="869.6211"/><polygon fill="#A80036" points="961,859.6211,965,869.6211,969,859.6211,965,863.6211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.75" x2="266.75" y1="1283.4023" y2="1303.4023"/><polygon fill="#A80036" points="262.75,1293.4023,266.75,1303.4023,270.75,1293.4023,266.75,1297.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="657" x2="657" y1="903.5898" y2="1303.4023"/><polygon fill="#A80036" points="653,1293.4023,657,1303.4023,661,1293.4023,657,1297.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="811" x2="811" y1="903.5898" y2="1303.4023"/><polygon fill="#A80036" points="807,1293.4023,811,1303.4023,815,1293.4023,811,1297.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="965" x2="965" y1="903.5898" y2="1303.4023"/><polygon fill="#A80036" points="961,1293.4023,965,1303.4023,969,1293.4023,965,1297.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="426.4063" y2="446.4063"/><polygon fill="#A80036" points="556,436.4063,560,446.4063,564,436.4063,560,440.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="372.4375" y2="392.4375"/><polygon fill="#A80036" points="556,382.4375,560,392.4375,564,382.4375,560,386.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="560" y1="1309.4023" y2="1319.4023"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560" x2="1061" y1="1319.4023" y2="1319.4023"/><polygon fill="#A80036" points="1057,850.1211,1061,840.1211,1065,850.1211,1061,846.1211" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1061" x2="1061" y1="360.4375" y2="1319.4023"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1061" x2="630" y1="360.4375" y2="360.4375"/><polygon fill="#A80036" points="640,356.4375,630,360.4375,640,364.4375,636,360.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="490" x2="24" y1="360.4375" y2="360.4375"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="24" y1="360.4375" y2="392.4375"/><polygon fill="#A80036" points="20,382.4375,24,392.4375,28,382.4375,24,386.4375" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[72a5dc6f55dac0b80c45076bb0fbb8e4]
@startuml
start
:start thread pool;
while (server is running)
    :server listen on port X;
    :incomming tcp connection;
    :add new job to the thread pool queue;
    note left
        a worker thread handles the connection
        from start to end - this can be optimized
        using event-driven approach but we choose
        not to as it's an overkill for this assignment
    endnote
endwhile
detach
end

while (thread pool has jobs)
    :send job to a worker thread;
    fork
        if (HTTP CONNECT) then (yes)
            :parse HTTP message and\nextract server address;
        else (no)
            :create ssl frontend handler and\nbind tcp socket to it;
            if (SNI extension present) then (yes)
                :extract SNI;
            else (no)
                :close connection;
                end
            endif
        endif
        :create ssl client;
        if (server certificate **not** in local cache) then (yes)
            :connect to the server;
            :generate dynamic certificate using\nthe real server certificate\nand configured key and CA certificate;
            :save certificate in local cache;
        endif
        :use certificate for frontend connection;
        :read user HTTP request;
        :forward the message through all processing layers;
        :propegate server response back to the user;
     fork again
        :same handeling flow;
     fork again
        :same handeling flow;
     fork again
        :same handeling flow;
     endfork
endwhile
stop
@enduml

PlantUML version 1.2020.12(Sat Jun 06 10:54:15 UTC 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>